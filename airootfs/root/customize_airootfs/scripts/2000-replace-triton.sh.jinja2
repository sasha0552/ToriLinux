#!/bin/sh
set -eu

{% if platform == "cuda" %}
# use repo with patched packages
export PIP_EXTRA_INDEX_URL="https://sasha0552.github.io/pascal-pkgs-ci/"

# Iterate over all virtual environments with triton
for dir in $(find /home/tori -type d -wholename "*/site-packages/triton"); do
  # Get path to python interpreter
  interpreter=$(realpath -s "$dir/../../../../bin/python")

  # Replace triton
  transient-package install      \
    --interpreter "$interpreter" \
    --source triton              \
    --target triton-pascal
done
{% endif %}
